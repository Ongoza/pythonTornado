import tornado.web
import logging
import os.path
import tornado.websocket
import tornado.ioloop
import time
#import tornado.httpclient

from mako.lookup import TemplateLookup
from mako import exceptions

#udp



#import tornado.httpserver

from tornado.options import define, options



root = os.path.dirname(__file__)
template_root = os.path.join(root, 'templates')
blacklist_templates = ('layouts',)

template_lookup = TemplateLookup(input_encoding='utf-8',
                                 output_encoding='utf-8',
                                 encoding_errors='replace',
                                 directories=[template_root])



define("port", default=8008, help="run on the given port", type=int)
root = os.path.dirname(__file__)
clients = dict()
cmd = {'chart start': 'Chart_cmd(true,self.id)', 'chart stop': 'Chart_cmd(false,self.id)'}
static_path=os.path.join(root, 'static')

class ClientConnection():

    clients = set()

    def __init__(self, *args, **kwargs):
        self.id = None
        super(ClientConnection, self).__init__(*args, **kwargs)

    def on_open(self, *args, **kwargs):
        logging.warning('client connected')
        print "client connected id="+self.id
        self.clients.add(self)

    def on_message(self, message):
        logging.warning(message)
        print "message are "+message
        self.write_message(u"Your message was: " + message)
        if not self.id:
            self.id = message.get('id', None)
        self.send('Hello client %s' % self.id)

    def on_close(self):
        logging.warning('client disconnected')
        self.clients.remove(self)

class Application(tornado.web.Application):
    
    
    def __init__(self):
        
            settings = {
           # cookie_secret="ssss_",
          #  xsrf_cookies=True,
                "debug":True,
                #"static_path": os.path.join(root, "static" )           
                }
            
            handlers = [
            #(r'/', BroadcastHandler),
                    (r'/', IndexHandler),
                    (r'/websocket', WebSocketHandler),
                    (r'/static/(.*)', tornado.web.StaticFileHandler, {'path': static_path}),
                    #(r"/(apple-touch-icon\.png)", tornado.web.StaticFileHandler, dict(path = settings['static_path'])),
            #(r'^/(.*)$', MainHandler),
                    
                    ]
        
            tornado.web.Application.__init__(self, handlers, **settings)


class MainHandler(tornado.web.RequestHandler):
    def get(self, filename):
        self.write(render_template(filename))

class IndexHandler(tornado.web.RequestHandler):
    @tornado.web.asynchronous
    
    #def get(self):
    #   self.write("This is your responsetttttt")
    #   self.finish()
    def get(self, filename):
        #self.write(render_template(filename))
        self.render("console.html")
        
        #try:
        #    with open(os.path.join(root, 'console.html')) as f:
        #        self.write(f.read())
        #except IOError as e:
        #    self.write("404: Not Found" )
    def post(self):
        message = self.get_argument('message')
        print "message = " + message
        key = self.get_argument('id', None)
        for client in ClientConnection.clients:
            if key and not key == client.id:
                continue
            client.send(message)
        self.write('message send.')
        
        
class WebSocketHandler(tornado.websocket.WebSocketHandler):
    def open(self, *args):
        #print " start websocket"
        self.id = self.get_argument("Id")
        print " Start new connection client id ="+self.id
        self.stream.set_nodelay(True)
        clients[self.id] = {"id": self.id, "object": self}

    def on_message(self, message):        
        """
        when we receive some message we want some message handler..
        for this example i will just print message to console
        """
        print "Client %s received a message : %s" % (self.id, message)
        self.write_message("Client N" + self.id +". Command is:" + message + " OK")
        if self.id == "2222":
            arr = []
            arr.append("[[0,38],[1,83],[2,134],[3,186],[4,37],[5,61],[6,134],[7,19],[8,135],[9,23],[10,98],[11,180],[12,131],[13,117],[14,166],[15,54],[16,137],[17,177],[18,181],[19,41],[20,145],[21,14],[22,132],[23,109],[24,126],[25,50],[26,66],[27,195],[28,115],[29,80],[30,133],[31,127],[32,143],[33,157],[34,128],[35,125],[36,188],[37,46],[38,201],[39,199],[40,95],[41,91],[42,166],[43,26],[44,149],[45,136],[46,181],[47,59],[48,95],[49,185],[50,38],[51,187],[52,156],[53,73],[54,116],[55,34],[56,48],[57,111],[58,121],[59,162],[60,175],[61,102],[62,57],[63,69],[64,26],[65,17],[66,161],[67,119],[68,85],[69,154],[70,20],[71,151],[72,80],[73,107],[74,162],[75,63],[76,166],[77,100],[78,178],[79,157],[80,196],[81,75],[82,58],[83,57],[84,151],[85,44],[86,78],[87,126],[88,59],[89,146],[90,53],[91,70],[92,128],[93,199],[94,151],[95,171],[96,76],[97,76],[98,132],[99,39],[100,61],[101,70],[102,21],[103,74],[104,163],[105,169],[106,96],[107,89],[108,175],[109,167],[110,192],[111,89],[112,189],[113,139],[114,60],[115,124],[116,175],[117,189],[118,165],[119,155],[120,124],[121,186],[122,88],[123,73],[124,24],[125,136],[126,174],[127,165],[128,166],[129,155],[130,160],[131,187],[132,14],[133,165],[134,95],[135,55],[136,125],[137,86],[138,25],[139,196],[140,196],[141,39],[142,143],[143,62],[144,34],[145,22],[146,150],[147,47],[148,187],[149,50],[150,121],[151,65],[152,36],[153,187],[154,158],[155,199],[156,106],[157,74],[158,32],[159,59],[160,97],[161,188],[162,127],[163,183],[164,188],[165,58],[166,196],[167,167],[168,78],[169,149],[170,56],[171,24],[172,13],[173,61],[174,31],[175,146],[176,161],[177,143],[178,195],[179,189],[180,110],[181,146],[182,17],[183,76],[184,119],[185,159],[186,29],[187,28],[188,79],[189,38],[190,128],[191,57],[192,171],[193,82],[194,35],[195,156],[196,90],[197,187],[198,101],[199,52],[200,79],[201,136],[202,57],[203,113],[204,181],[205,164],[206,117],[207,61],[208,184],[209,182],[210,30],[211,143],[212,156],[213,157],[214,116],[215,13],[216,197],[217,112],[218,81],[219,167],[220,93],[221,96],[222,147],[223,196],[224,13],[225,171],[226,161],[227,66],[228,126],[229,17],[230,168],[231,146],[232,164],[233,93],[234,23],[235,40],[236,139],[237,36],[238,59],[239,63],[240,146],[241,18],[242,105],[243,81],[244,196],[245,57],[246,73],[247,100],[248,87],[249,68],[250,148],[251,147],[252,85],[253,45],[254,188],[255,34],[256,162],[257,112],[258,37],[259,58],[260,30],[261,91],[262,56],[263,129],[264,104],[265,88],[266,83],[267,71],[268,37],[269,166],[270,87],[271,63],[272,112],[273,42],[274,97],[275,133],[276,97],[277,79],[278,91],[279,185],[280,79],[281,69],[282,128],[283,34],[284,184],[285,135],[286,152],[287,105],[288,40],[289,115],[290,165],[291,100],[292,71],[293,161],[294,184],[295,88],[296,37],[297,177],[298,47],[299,158],[300,107],[301,183],[302,22],[303,132],[304,44],[305,93],[306,52],[307,81],[308,53],[309,109],[310,56],[311,194],[312,58],[313,196],[314,131],[315,166],[316,75],[317,85],[318,159],[319,34],[320,164],[321,115],[322,52],[323,18],[324,186],[325,139],[326,181],[327,162],[328,189],[329,17],[330,90],[331,147],[332,79],[333,64],[334,111],[335,192],[336,201],[337,153],[338,48],[339,72],[340,175],[341,46],[342,167],[343,55],[344,180],[345,164],[346,134],[347,181],[348,192],[349,121],[350,195],[351,79],[352,101],[353,197],[354,185],[355,158],[356,69],[357,28],[358,154],[359,75],[360,164],[361,21],[362,133],[363,108],[364,190],[365,154],[366,44],[367,91],[368,45],[369,48],[370,179],[371,194],[372,24],[373,70],[374,71],[375,38],[376,78],[377,139],[378,139],[379,183],[380,46],[381,166],[382,131],[383,32],[384,60],[385,156],[386,74],[387,39],[388,194],[389,200],[390,26],[391,104],[392,82],[393,182],[394,11],[395,181],[396,169],[397,104],[398,103],[399,110],[400,180],[401,119],[402,90],[403,10],[404,160],[405,150],[406,90],[407,100],[408,35],[409,156],[410,28],[411,60],[412,130],[413,139],[414,62],[415,122],[416,161],[417,96],[418,91],[419,12],[420,40],[421,187],[422,100],[423,181],[424,39],[425,127],[426,59],[427,190],[428,82],[429,61],[430,134],[431,196],[432,133],[433,89],[434,41],[435,18],[436,65],[437,133],[438,85],[439,60],[440,184],[441,145],[442,45],[443,119],[444,172],[445,91],[446,110],[447,142],[448,122],[449,200],[450,51],[451,108],[452,26],[453,12],[454,12],[455,140],[456,119],[457,84],[458,184],[459,162],[460,75],[461,62],[462,68],[463,133],[464,199],[465,169],[466,68],[467,188],[468,70],[469,48],[470,107],[471,94],[472,52],[473,159],[474,91],[475,100],[476,178],[477,138],[478,126],[479,17],[480,156],[481,86],[482,33],[483,103],[484,75],[485,106],[486,13],[487,107],[488,37],[489,176],[490,201],[491,157],[492,193],[493,162],[494,113],[495,24],[496,89],[497,110],[498,15],[499,124],[500,99],[501,110],[502,112],[503,109],[504,117],[505,113],[506,136],[507,32],[508,39],[509,75],[510,33],[511,197],[512,184],[513,192],[514,14],[515,179],[516,167],[517,62],[518,186],[519,147],[520,93],[521,19],[522,152],[523,159],[524,155],[525,161],[526,130],[527,168],[528,114],[529,139],[530,190],[531,107],[532,187],[533,78],[534,151],[535,38],[536,161],[537,136],[538,97],[539,32],[540,122],[541,193],[542,174],[543,172],[544,111],[545,138],[546,109],[547,149],[548,114],[549,167],[550,196],[551,39],[552,189],[553,128],[554,38],[555,62],[556,85],[557,96],[558,153],[559,185],[560,118],[561,101],[562,175],[563,40],[564,35],[565,91],[566,167],[567,167],[568,121],[569,87],[570,179],[571,187],[572,133],[573,157],[574,76],[575,78],[576,73],[577,175],[578,183],[579,12],[580,161],[581,174],[582,117],[583,78],[584,112],[585,129],[586,98],[587,137],[588,59],[589,42],[590,79],[591,141],[592,177],[593,51],[594,99],[595,34],[596,161],[597,92],[598,103],[599,185],[600,165],[601,48],[602,69],[603,47],[604,94],[605,87],[606,15],[607,139],[608,196],[609,91],[610,173],[611,62],[612,156],[613,148],[614,98],[615,58],[616,97],[617,137],[618,136],[619,59],[620,41],[621,19],[622,141],[623,184],[624,148],[625,101],[626,145],[627,48],[628,148],[629,16],[630,112],[631,163],[632,113],[633,61],[634,46],[635,60],[636,106],[637,92],[638,194],[639,194],[640,11],[641,47],[642,198],[643,196],[644,36],[645,121],[646,64],[647,151],[648,97],[649,171],[650,146],[651,69],[652,32],[653,135],[654,65],[655,182],[656,26],[657,100],[658,135],[659,104],[660,114],[661,75],[662,106],[663,171],[664,27],[665,123],[666,84],[667,51],[668,187],[669,68],[670,66],[671,17],[672,199],[673,161],[674,60],[675,41],[676,62],[677,65],[678,28],[679,119],[680,61],[681,27],[682,81],[683,51],[684,190],[685,25],[686,43],[687,64],[688,181],[689,42],[690,194],[691,23],[692,152],[693,41],[694,187],[695,138],[696,25],[697,76],[698,153],[699,91],[700,105],[701,141],[702,164],[703,141],[704,56],[705,127],[706,88],[707,163],[708,56],[709,107],[710,138],[711,103],[712,192],[713,123],[714,129],[715,137],[716,85],[717,183],[718,41],[719,169],[720,124],[721,62],[722,139],[723,122],[724,130],[725,54],[726,74],[727,81],[728,168],[729,68],[730,48],[731,171],[732,75],[733,125],[734,185],[735,11],[736,100],[737,129],[738,46],[739,198],[740,108],[741,109],[742,52],[743,20],[744,73],[745,16],[746,65],[747,174],[748,57],[749,51],[750,24],[751,177],[752,29],[753,83],[754,71],[755,194],[756,161],[757,185],[758,91],[759,193],[760,170],[761,141],[762,73],[763,25],[764,199],[765,87],[766,63],[767,185],[768,178],[769,134],[770,124],[771,161],[772,60],[773,50],[774,35],[775,136],[776,46],[777,91],[778,108],[779,169],[780,89],[781,33],[782,150],[783,162],[784,22],[785,112],[786,45],[787,125],[788,102],[789,80],[790,134],[791,66],[792,71],[793,30],[794,170],[795,129],[796,43],[797,37],[798,110],[799,173],[800,193],[801,174],[802,73],[803,15],[804,121],[805,50],[806,58],[807,122],[808,167],[809,118],[810,100],[811,48],[812,120],[813,200],[814,55],[815,78],[816,57],[817,198],[818,57],[819,102],[820,68],[821,134],[822,98],[823,77],[824,62],[825,200],[826,55],[827,121],[828,122],[829,69],[830,96],[831,47],[832,44],[833,37],[834,37],[835,118],[836,178],[837,114],[838,123],[839,26],[840,16],[841,116],[842,60],[843,10],[844,30],[845,137],[846,172],[847,117],[848,119],[849,71],[850,170],[851,23],[852,24],[853,25],[854,184],[855,123],[856,59],[857,51],[858,37],[859,16],[860,48],[861,53],[862,35],[863,23],[864,124],[865,18],[866,72],[867,84],[868,148],[869,30],[870,39],[871,71],[872,60],[873,125],[874,57],[875,23],[876,190],[877,94],[878,190],[879,68],[880,35],[881,118],[882,127],[883,183],[884,108],[885,169],[886,50],[887,44],[888,94],[889,78],[890,180],[891,153],[892,170],[893,55],[894,137],[895,36],[896,144],[897,151],[898,120],[899,118]]")
            arr.append("[[0,38],[1,83],[2,134],[3,186],[4,37],[5,61]]")
            arr.append("[[0,38],[1,83],[2,134],[3,186],[4,37],[5,61],[6,134],[7,19],[8,135],[9,23],[10,98],[11,180],[12,131],[13,117],[14,166],[15,54],[16,137],[17,177],[18,181],[19,41],[20,145],[21,14],[22,132],[23,109],[24,126],[25,50],[26,66],[27,195],[28,115],[29,80],[30,133],[31,127],[32,143],[33,157],[34,128],[35,125],[36,188],[37,46],[38,201],[39,199],[40,95],[41,91],[42,166],[43,26],[44,149],[45,136],[46,181],[47,59],[48,95],[49,185],[50,38],[51,187],[52,156],[53,73],[54,116],[55,34],[56,48],[57,111],[58,121],[59,162],[60,175],[61,102],[62,57],[63,69],[64,26],[65,17],[66,161],[67,119],[68,85],[69,154],[70,20],[71,151],[72,80],[73,107],[74,162],[75,63],[76,166],[77,100],[78,178],[79,157],[80,196],[81,75],[82,58],[83,57],[84,151],[85,44],[86,78],[87,126],[88,59],[89,146],[90,53],[91,70],[92,128],[93,199],[94,151],[95,171],[96,76],[97,76],[98,132],[99,39],[100,61],[101,70],[102,21],[103,74],[104,163],[105,169],[106,96],[107,89],[108,175],[109,167],[110,192],[111,89],[112,189],[113,139],[114,60],[115,124],[116,175],[117,189],[118,165],[119,155],[120,124],[121,186],[122,88],[123,73],[124,24],[125,136],[126,174],[127,165],[128,166],[129,155],[130,160],[131,187],[132,14],[133,165],[134,95],[135,55],[136,125],[137,86],[138,25],[139,196],[140,196],[141,39],[142,143],[143,62],[144,34],[145,22],[146,150],[147,47],[148,187],[149,50],[150,121],[151,65],[152,36],[153,187],[154,158],[155,199],[156,106],[157,74],[158,32],[159,59],[160,97],[161,188],[162,127],[163,183],[164,188],[165,58],[166,196],[167,167],[168,78],[169,149],[170,56],[171,24],[172,13],[173,61],[174,31],[175,146],[176,161],[177,143],[178,195],[179,189],[180,110],[181,146],[182,17],[183,76],[184,119],[185,159],[186,29],[187,28],[188,79],[189,38],[190,128],[191,57],[192,171],[193,82],[194,35],[195,156],[196,90],[197,187],[198,101],[199,52],[200,79],[201,136],[202,57],[203,113],[204,181],[205,164],[206,117],[207,61],[208,184],[209,182],[210,30],[211,143],[212,156],[213,157],[214,116],[215,13],[216,197],[217,112],[218,81],[219,167],[220,93],[221,96],[222,147],[223,196],[224,13],[225,171],[226,161],[227,66],[228,126],[229,17],[230,168],[231,146],[232,164],[233,93],[234,23],[235,40],[236,139],[237,36],[238,59],[239,63],[240,146],[241,18],[242,105],[243,81],[244,196],[245,57],[246,73],[247,100],[248,87],[249,68],[250,148],[251,147],[252,85],[253,45],[254,188],[255,34],[256,162],[257,112],[258,37],[259,58],[260,30],[261,91],[262,56],[263,129],[264,104],[265,88],[266,83],[267,71],[268,37],[269,166],[270,87],[271,63],[272,112],[273,42],[274,97],[275,133],[276,97],[277,79],[278,91],[279,185],[280,79],[281,69],[282,128],[283,34],[284,184],[285,135],[286,152],[287,105],[288,40],[289,115],[290,165],[291,100],[292,71],[293,161],[294,184],[295,88],[296,37],[297,177],[298,47],[299,158],[300,107],[301,183],[302,22],[303,132],[304,44],[305,93],[306,52],[307,81],[308,53],[309,109],[310,56],[311,194],[312,58],[313,196],[314,131],[315,166],[316,75],[317,85],[318,159],[319,34],[320,164],[321,115],[322,52],[323,18],[324,186],[325,139],[326,181],[327,162],[328,189],[329,17],[330,90],[331,147],[332,79],[333,64],[334,111],[335,192],[336,201],[337,153],[338,48],[339,72],[340,175],[341,46],[342,167],[343,55],[344,180],[345,164],[346,134],[347,181],[348,192],[349,121],[350,195],[351,79],[352,101],[353,197],[354,185],[355,158],[356,69],[357,28],[358,154],[359,75],[360,164],[361,21],[362,133],[363,108],[364,190],[365,154],[366,44],[367,91],[368,45],[369,48],[370,179],[371,194],[372,24],[373,70],[374,71],[375,38],[376,78],[377,139],[378,139],[379,183],[380,46],[381,166],[382,131],[383,32],[384,60],[385,156],[386,74],[387,39],[388,194],[389,200],[390,26],[391,104],[392,82],[393,182],[394,11],[395,181],[396,169],[397,104],[398,103],[399,110],[400,180],[401,119],[402,90],[403,10],[404,160],[405,150],[406,90],[407,100],[408,35],[409,156],[410,28],[411,60],[412,130],[413,139],[414,62],[415,122],[416,161],[417,96],[418,91],[419,12],[420,40],[421,187],[422,100],[423,181],[424,39],[425,127],[426,59],[427,190],[428,82],[429,61],[430,134],[431,196],[432,133],[433,89],[434,41],[435,18],[436,65],[437,133],[438,85],[439,60],[440,184],[441,145],[442,45],[443,119],[444,172],[445,91],[446,110],[447,142],[448,122],[449,200],[450,51],[451,108],[452,26],[453,12],[454,12],[455,140],[456,119],[457,84],[458,184],[459,162],[460,75],[461,62],[462,68],[463,133],[464,199],[465,169],[466,68],[467,188],[468,70],[469,48],[470,107],[471,94],[472,52],[473,159],[474,91],[475,100],[476,178],[477,138],[478,126],[479,17],[480,156],[481,86],[482,33],[483,103],[484,75],[485,106],[486,13],[487,107],[488,37],[489,176],[490,201],[491,157],[492,193],[493,162],[494,113],[495,24],[496,89],[497,110],[498,15],[499,124],[500,99],[501,110],[502,112],[503,109],[504,117],[505,113],[506,136],[507,32],[508,39],[509,75],[510,33],[511,197],[512,184],[513,192],[514,14],[515,179],[516,167],[517,62],[518,186],[519,147],[520,93],[521,19],[522,152],[523,159],[524,155],[525,161],[526,130],[527,168],[528,114],[529,139],[530,190],[531,107],[532,187],[533,78],[534,151],[535,38],[536,161],[537,136],[538,97],[539,32],[540,122],[541,193],[542,174],[543,172],[544,111],[545,138],[546,109],[547,149],[548,114],[549,167],[550,196],[551,39],[552,189],[553,128],[554,38],[555,62],[556,85],[557,96],[558,153],[559,185],[560,118],[561,101],[562,175],[563,40],[564,35],[565,91],[566,167],[567,167],[568,121],[569,87],[570,179],[571,187],[572,133],[573,157],[574,76],[575,78],[576,73],[577,175],[578,183],[579,12],[580,161],[581,174],[582,117],[583,78],[584,112],[585,129],[586,98],[587,137],[588,59],[589,42],[590,79],[591,141],[592,177],[593,51],[594,99],[595,34],[596,161],[597,92],[598,103],[599,185],[600,165],[601,48],[602,69],[603,47],[604,94],[605,87],[606,15],[607,139],[608,196],[609,91],[610,173],[611,62],[612,156],[613,148],[614,98],[615,58],[616,97],[617,137],[618,136],[619,59],[620,41],[621,19],[622,141],[623,184],[624,148],[625,101],[626,145],[627,48],[628,148],[629,16],[630,112],[631,163],[632,113],[633,61],[634,46],[635,60],[636,106],[637,92],[638,194],[639,194],[640,11],[641,47],[642,198],[643,196],[644,36],[645,121],[646,64],[647,151],[648,97],[649,171],[650,146],[651,69],[652,32],[653,135],[654,65],[655,182],[656,26],[657,100],[658,135],[659,104],[660,114],[661,75],[662,106],[663,171],[664,27],[665,123],[666,84],[667,51],[668,187],[669,68],[670,66],[671,17],[672,199],[673,161],[674,60],[675,41],[676,62],[677,65],[678,28],[679,119],[680,61],[681,27],[682,81],[683,51],[684,190],[685,25],[686,43],[687,64],[688,181],[689,42],[690,194],[691,23],[692,152],[693,41],[694,187],[695,138],[696,25],[697,76],[698,153],[699,91],[700,105],[701,141],[702,164],[703,141],[704,56],[705,127],[706,88],[707,163],[708,56],[709,107],[710,138],[711,103],[712,192],[713,123],[714,129],[715,137],[716,85],[717,183],[718,41],[719,169],[720,124],[721,62],[722,139],[723,122],[724,130],[725,54],[726,74],[727,81],[728,168],[729,68],[730,48],[731,171],[732,75],[733,125],[734,185],[735,11],[736,100],[737,129],[738,46],[739,198],[740,108],[741,109],[742,52],[743,20],[744,73],[745,16],[746,65],[747,174],[748,57],[749,51],[750,24],[751,177],[752,29],[753,83],[754,71],[755,194],[756,161],[757,185],[758,91],[759,193],[760,170],[761,141],[762,73],[763,25],[764,199],[765,87],[766,63],[767,185],[768,178],[769,134],[770,124],[771,161],[772,60],[773,50],[774,35],[775,136],[776,46],[777,91],[778,108],[779,169],[780,89],[781,33],[782,150],[783,162],[784,22],[785,112],[786,45],[787,125],[788,102],[789,80],[790,134],[791,66],[792,71],[793,30],[794,170],[795,129],[796,43],[797,37],[798,110],[799,173],[800,193],[801,174],[802,73],[803,15],[804,121],[805,50],[806,58],[807,122],[808,167],[809,118],[810,100],[811,48],[812,120],[813,200],[814,55],[815,78],[816,57],[817,198],[818,57],[819,102],[820,68],[821,134],[822,98],[823,77],[824,62],[825,200],[826,55],[827,121],[828,122],[829,69],[830,96],[831,47],[832,44],[833,37],[834,37],[835,118],[836,178],[837,114],[838,123],[839,26],[840,16],[841,116],[842,60],[843,10],[844,30],[845,137],[846,172],[847,117],[848,119],[849,71],[850,170],[851,23],[852,24],[853,25],[854,184],[855,123],[856,59],[857,51],[858,37],[859,16],[860,48],[861,53],[862,35],[863,23],[864,124],[865,18],[866,72],[867,84],[868,148],[869,30],[870,39],[871,71],[872,60],[873,125],[874,57],[875,23],[876,190],[877,94],[878,190],[879,68],[880,35],[881,118],[882,127],[883,183],[884,108],[885,169],[886,50],[887,44],[888,94],[889,78],[890,180],[891,153],[892,170],[893,55],[894,137],[895,36],[896,144],[897,151],[898,120],[899,118]]")
            arr.append("[[0,38],[1,83],[897,151],[898,120],[899,118]]")
            arr.append("[[0,38],[1,83],[2,134],[3,186],[4,37],[5,61],[6,134],[7,19],[8,135],[9,23],[10,98],[11,180],[12,131],[13,117],[14,166],[15,54],[16,137],[17,177],[18,181],[19,41],[20,145],[21,14],[22,132],[23,109],[24,126],[25,50],[26,66],[27,195],[28,115],[29,80],[30,133],[31,127],[32,143],[33,157],[34,128],[35,125],[36,188],[37,46],[38,201],[39,199],[40,95],[41,91],[42,166],[43,26],[44,149],[45,136],[46,181],[47,59],[48,95],[49,185],[50,38],[51,187],[52,156],[53,73],[54,116],[55,34],[56,48],[57,111],[58,121],[59,162],[60,175],[61,102],[62,57],[63,69],[64,26],[65,17],[66,161],[67,119],[68,85],[69,154],[70,20],[71,151],[72,80],[73,107],[74,162],[75,63],[76,166],[77,100],[78,178],[79,157],[80,196],[81,75],[82,58],[83,57],[84,151],[85,44],[86,78],[87,126],[88,59],[89,146],[90,53],[91,70],[92,128],[93,199],[94,151],[95,171],[96,76],[97,76],[98,132],[99,39],[100,61],[101,70],[102,21],[103,74],[104,163],[105,169],[106,96],[107,89],[108,175],[109,167],[110,192],[111,89],[112,189],[113,139],[114,60],[115,124],[116,175],[117,189],[118,165],[119,155],[120,124],[121,186],[122,88],[123,73],[124,24],[125,136],[126,174],[127,165],[128,166],[129,155],[130,160],[131,187],[132,14],[133,165],[134,95],[135,55],[136,125],[137,86],[138,25],[139,196],[140,196],[141,39],[142,143],[143,62],[144,34],[145,22],[146,150],[147,47],[148,187],[149,50],[150,121],[151,65],[152,36],[153,187],[154,158],[155,199],[156,106],[157,74],[158,32],[159,59],[160,97],[161,188],[162,127],[163,183],[164,188],[165,58],[166,196],[167,167],[168,78],[169,149],[170,56],[171,24],[172,13],[173,61],[174,31],[175,146],[176,161],[177,143],[178,195],[179,189],[180,110],[181,146],[182,17],[183,76],[184,119],[185,159],[186,29],[187,28],[188,79],[189,38],[190,128],[191,57],[192,171],[193,82],[194,35],[195,156],[196,90],[197,187],[198,101],[199,52],[200,79],[201,136],[202,57],[203,113],[204,181],[205,164],[206,117],[207,61],[208,184],[209,182],[210,30],[211,143],[212,156],[213,157],[214,116],[215,13],[216,197],[217,112],[218,81],[219,167],[220,93],[221,96],[222,147],[223,196],[224,13],[225,171],[226,161],[227,66],[228,126],[229,17],[230,168],[231,146],[232,164],[233,93],[234,23],[235,40],[236,139],[237,36],[238,59],[239,63],[240,146],[241,18],[242,105],[243,81],[244,196],[245,57],[246,73],[247,100],[248,87],[249,68],[250,148],[251,147],[252,85],[253,45],[254,188],[255,34],[256,162],[257,112],[258,37],[259,58],[260,30],[261,91],[262,56],[263,129],[264,104],[265,88],[266,83],[267,71],[268,37],[269,166],[270,87],[271,63],[272,112],[273,42],[274,97],[275,133],[276,97],[277,79],[278,91],[279,185],[280,79],[281,69],[282,128],[283,34],[284,184],[285,135],[286,152],[287,105],[288,40],[289,115],[290,165],[291,100],[292,71],[293,161],[294,184],[295,88],[296,37],[297,177],[298,47],[299,158],[300,107],[301,183],[302,22],[303,132],[304,44],[305,93],[306,52],[307,81],[308,53],[309,109],[310,56],[311,194],[312,58],[313,196],[314,131],[315,166],[316,75],[317,85],[318,159],[319,34],[320,164],[321,115],[322,52],[323,18],[324,186],[325,139],[326,181],[327,162],[328,189],[329,17],[330,90],[331,147],[332,79],[333,64],[334,111],[335,192],[336,201],[337,153],[338,48],[339,72],[340,175],[341,46],[342,167],[343,55],[344,180],[345,164],[346,134],[347,181],[348,192],[349,121],[350,195],[351,79],[352,101],[353,197],[354,185],[355,158],[356,69],[357,28],[358,154],[359,75],[360,164],[361,21],[362,133],[363,108],[364,190],[365,154],[366,44],[367,91],[368,45],[369,48],[370,179],[371,194],[372,24],[373,70],[374,71],[375,38],[376,78],[377,139],[378,139],[379,183],[380,46],[381,166],[382,131],[383,32],[384,60],[385,156],[386,74],[387,39],[388,194],[389,200],[390,26],[391,104],[392,82],[393,182],[394,11],[395,181],[396,169],[397,104],[398,103],[399,110],[400,180],[401,119],[402,90],[403,10],[404,160],[405,150],[406,90],[407,100],[408,35],[409,156],[410,28],[411,60],[412,130],[413,139],[414,62],[415,122],[416,161],[417,96],[418,91],[419,12],[420,40],[421,187],[422,100],[423,181],[424,39],[425,127],[426,59],[427,190],[428,82],[429,61],[430,134],[431,196],[432,133],[433,89],[434,41],[435,18],[436,65],[437,133],[438,85],[439,60],[440,184],[441,145],[442,45],[443,119],[444,172],[445,91],[446,110],[447,142],[448,122],[449,200],[450,51],[451,108],[452,26],[453,12],[454,12],[455,140],[456,119],[457,84],[458,184],[459,162],[460,75],[461,62],[462,68],[463,133],[464,199],[465,169],[466,68],[467,188],[468,70],[469,48],[470,107],[471,94],[472,52],[473,159],[474,91],[475,100],[476,178],[477,138],[478,126],[479,17],[480,156],[481,86],[482,33],[483,103],[484,75],[485,106],[486,13],[487,107],[488,37],[489,176],[490,201],[491,157],[492,193],[493,162],[494,113],[495,24],[496,89],[497,110],[498,15],[499,124],[500,99],[501,110],[502,112],[503,109],[504,117],[505,113],[506,136],[507,32],[508,39],[509,75],[510,33],[511,197],[512,184],[513,192],[514,14],[515,179],[516,167],[517,62],[518,186],[519,147],[520,93],[521,19],[522,152],[523,159],[524,155],[525,161],[526,130],[527,168],[528,114],[529,139],[530,190],[531,107],[532,187],[533,78],[534,151],[535,38],[536,161],[537,136],[538,97],[539,32],[540,122],[541,193],[542,174],[543,172],[544,111],[545,138],[546,109],[547,149],[548,114],[549,167],[550,196],[551,39],[552,189],[553,128],[554,38],[555,62],[556,85],[557,96],[558,153],[559,185],[560,118],[561,101],[562,175],[563,40],[564,35],[565,91],[566,167],[567,167],[568,121],[569,87],[570,179],[571,187],[572,133],[573,157],[574,76],[575,78],[576,73],[577,175],[578,183],[579,12],[580,161],[581,174],[582,117],[583,78],[584,112],[585,129],[586,98],[587,137],[588,59],[589,42],[590,79],[591,141],[592,177],[593,51],[594,99],[595,34],[596,161],[597,92],[598,103],[599,185],[600,165],[601,48],[602,69],[603,47],[604,94],[605,87],[606,15],[607,139],[608,196],[609,91],[610,173],[611,62],[612,156],[613,148],[614,98],[615,58],[616,97],[617,137],[618,136],[619,59],[620,41],[621,19],[622,141],[623,184],[624,148],[625,101],[626,145],[627,48],[628,148],[629,16],[630,112],[631,163],[632,113],[633,61],[634,46],[635,60],[636,106],[637,92],[638,194],[639,194],[640,11],[641,47],[642,198],[643,196],[644,36],[645,121],[646,64],[647,151],[648,97],[649,171],[650,146],[651,69],[652,32],[653,135],[654,65],[655,182],[656,26],[657,100],[658,135],[659,104],[660,114],[661,75],[662,106],[663,171],[664,27],[665,123],[666,84],[667,51],[668,187],[669,68],[670,66],[671,17],[672,199],[673,161],[674,60],[675,41],[676,62],[677,65],[678,28],[679,119],[680,61],[681,27],[682,81],[683,51],[684,190],[685,25],[686,43],[687,64],[688,181],[689,42],[690,194],[691,23],[692,152],[693,41],[694,187],[695,138],[696,25],[697,76],[698,153],[699,91],[700,105],[701,141],[702,164],[703,141],[704,56],[705,127],[706,88],[707,163],[708,56],[709,107],[710,138],[711,103],[712,192],[713,123],[714,129],[715,137],[716,85],[717,183],[718,41],[719,169],[720,124],[721,62],[722,139],[723,122],[724,130],[725,54],[726,74],[727,81],[728,168],[729,68],[730,48],[731,171],[732,75],[733,125],[734,185],[735,11],[736,100],[737,129],[738,46],[739,198],[740,108],[741,109],[742,52],[743,20],[744,73],[745,16],[746,65],[747,174],[748,57],[749,51],[750,24],[751,177],[752,29],[753,83],[754,71],[755,194],[756,161],[757,185],[758,91],[759,193],[760,170],[761,141],[762,73],[763,25],[764,199],[765,87],[766,63],[767,185],[768,178],[769,134],[770,124],[771,161],[772,60],[773,50],[774,35],[775,136],[776,46],[777,91],[778,108],[779,169],[780,89],[781,33],[782,150],[783,162],[784,22],[785,112],[786,45],[787,125],[788,102],[789,80],[790,134],[791,66],[792,71],[793,30],[794,170],[795,129],[796,43],[797,37],[798,110],[799,173],[800,193],[801,174],[802,73],[803,15],[804,121],[805,50],[806,58],[807,122],[808,167],[809,118],[810,100],[811,48],[812,120],[813,200],[814,55],[815,78],[816,57],[817,198],[818,57],[819,102],[820,68],[821,134],[822,98],[823,77],[824,62],[825,200],[826,55],[827,121],[828,122],[829,69],[830,96],[831,47],[832,44],[833,37],[834,37],[835,118],[836,178],[837,114],[838,123],[839,26],[840,16],[841,116],[842,60],[843,10],[844,30],[845,137],[846,172],[847,117],[848,119],[849,71],[850,170],[851,23],[852,24],[853,25],[854,184],[855,123],[856,59],[857,51],[858,37],[859,16],[860,48],[861,53],[862,35],[863,23],[864,124],[865,18],[866,72],[867,84],[868,148],[869,30],[870,39],[871,71],[872,60],[873,125],[874,57],[875,23],[876,190],[877,94],[878,190],[879,68],[880,35],[881,118],[882,127],[883,183],[884,108],[885,169],[886,50],[887,44],[888,94],[889,78],[890,180],[891,153],[892,170],[893,55],[894,137],[895,36],[896,144],[897,151],[898,120],[899,118]]")
            
            #var_txt ="[[0,38],[1,83],[2,134],[3,186],[4,37],[5,61],[6,134],[7,19],[8,135],[9,23],[10,98],[11,180],[12,131],[13,117],[14,166],[15,54],[16,137],[17,177],[18,181],[19,41],[20,145],[21,14],[22,132],[23,109],[24,126],[25,50],[26,66],[27,195],[28,115],[29,80],[30,133],[31,127],[32,143],[33,157],[34,128],[35,125],[36,188],[37,46],[38,201],[39,199],[40,95],[41,91],[42,166],[43,26],[44,149],[45,136],[46,181],[47,59],[48,95],[49,185],[50,38],[51,187],[52,156],[53,73],[54,116],[55,34],[56,48],[57,111],[58,121],[59,162],[60,175],[61,102],[62,57],[63,69],[64,26],[65,17],[66,161],[67,119],[68,85],[69,154],[70,20],[71,151],[72,80],[73,107],[74,162],[75,63],[76,166],[77,100],[78,178],[79,157],[80,196],[81,75],[82,58],[83,57],[84,151],[85,44],[86,78],[87,126],[88,59],[89,146],[90,53],[91,70],[92,128],[93,199],[94,151],[95,171],[96,76],[97,76],[98,132],[99,39],[100,61],[101,70],[102,21],[103,74],[104,163],[105,169],[106,96],[107,89],[108,175],[109,167],[110,192],[111,89],[112,189],[113,139],[114,60],[115,124],[116,175],[117,189],[118,165],[119,155],[120,124],[121,186],[122,88],[123,73],[124,24],[125,136],[126,174],[127,165],[128,166],[129,155],[130,160],[131,187],[132,14],[133,165],[134,95],[135,55],[136,125],[137,86],[138,25],[139,196],[140,196],[141,39],[142,143],[143,62],[144,34],[145,22],[146,150],[147,47],[148,187],[149,50],[150,121],[151,65],[152,36],[153,187],[154,158],[155,199],[156,106],[157,74],[158,32],[159,59],[160,97],[161,188],[162,127],[163,183],[164,188],[165,58],[166,196],[167,167],[168,78],[169,149],[170,56],[171,24],[172,13],[173,61],[174,31],[175,146],[176,161],[177,143],[178,195],[179,189],[180,110],[181,146],[182,17],[183,76],[184,119],[185,159],[186,29],[187,28],[188,79],[189,38],[190,128],[191,57],[192,171],[193,82],[194,35],[195,156],[196,90],[197,187],[198,101],[199,52],[200,79],[201,136],[202,57],[203,113],[204,181],[205,164],[206,117],[207,61],[208,184],[209,182],[210,30],[211,143],[212,156],[213,157],[214,116],[215,13],[216,197],[217,112],[218,81],[219,167],[220,93],[221,96],[222,147],[223,196],[224,13],[225,171],[226,161],[227,66],[228,126],[229,17],[230,168],[231,146],[232,164],[233,93],[234,23],[235,40],[236,139],[237,36],[238,59],[239,63],[240,146],[241,18],[242,105],[243,81],[244,196],[245,57],[246,73],[247,100],[248,87],[249,68],[250,148],[251,147],[252,85],[253,45],[254,188],[255,34],[256,162],[257,112],[258,37],[259,58],[260,30],[261,91],[262,56],[263,129],[264,104],[265,88],[266,83],[267,71],[268,37],[269,166],[270,87],[271,63],[272,112],[273,42],[274,97],[275,133],[276,97],[277,79],[278,91],[279,185],[280,79],[281,69],[282,128],[283,34],[284,184],[285,135],[286,152],[287,105],[288,40],[289,115],[290,165],[291,100],[292,71],[293,161],[294,184],[295,88],[296,37],[297,177],[298,47],[299,158],[300,107],[301,183],[302,22],[303,132],[304,44],[305,93],[306,52],[307,81],[308,53],[309,109],[310,56],[311,194],[312,58],[313,196],[314,131],[315,166],[316,75],[317,85],[318,159],[319,34],[320,164],[321,115],[322,52],[323,18],[324,186],[325,139],[326,181],[327,162],[328,189],[329,17],[330,90],[331,147],[332,79],[333,64],[334,111],[335,192],[336,201],[337,153],[338,48],[339,72],[340,175],[341,46],[342,167],[343,55],[344,180],[345,164],[346,134],[347,181],[348,192],[349,121],[350,195],[351,79],[352,101],[353,197],[354,185],[355,158],[356,69],[357,28],[358,154],[359,75],[360,164],[361,21],[362,133],[363,108],[364,190],[365,154],[366,44],[367,91],[368,45],[369,48],[370,179],[371,194],[372,24],[373,70],[374,71],[375,38],[376,78],[377,139],[378,139],[379,183],[380,46],[381,166],[382,131],[383,32],[384,60],[385,156],[386,74],[387,39],[388,194],[389,200],[390,26],[391,104],[392,82],[393,182],[394,11],[395,181],[396,169],[397,104],[398,103],[399,110],[400,180],[401,119],[402,90],[403,10],[404,160],[405,150],[406,90],[407,100],[408,35],[409,156],[410,28],[411,60],[412,130],[413,139],[414,62],[415,122],[416,161],[417,96],[418,91],[419,12],[420,40],[421,187],[422,100],[423,181],[424,39],[425,127],[426,59],[427,190],[428,82],[429,61],[430,134],[431,196],[432,133],[433,89],[434,41],[435,18],[436,65],[437,133],[438,85],[439,60],[440,184],[441,145],[442,45],[443,119],[444,172],[445,91],[446,110],[447,142],[448,122],[449,200],[450,51],[451,108],[452,26],[453,12],[454,12],[455,140],[456,119],[457,84],[458,184],[459,162],[460,75],[461,62],[462,68],[463,133],[464,199],[465,169],[466,68],[467,188],[468,70],[469,48],[470,107],[471,94],[472,52],[473,159],[474,91],[475,100],[476,178],[477,138],[478,126],[479,17],[480,156],[481,86],[482,33],[483,103],[484,75],[485,106],[486,13],[487,107],[488,37],[489,176],[490,201],[491,157],[492,193],[493,162],[494,113],[495,24],[496,89],[497,110],[498,15],[499,124],[500,99],[501,110],[502,112],[503,109],[504,117],[505,113],[506,136],[507,32],[508,39],[509,75],[510,33],[511,197],[512,184],[513,192],[514,14],[515,179],[516,167],[517,62],[518,186],[519,147],[520,93],[521,19],[522,152],[523,159],[524,155],[525,161],[526,130],[527,168],[528,114],[529,139],[530,190],[531,107],[532,187],[533,78],[534,151],[535,38],[536,161],[537,136],[538,97],[539,32],[540,122],[541,193],[542,174],[543,172],[544,111],[545,138],[546,109],[547,149],[548,114],[549,167],[550,196],[551,39],[552,189],[553,128],[554,38],[555,62],[556,85],[557,96],[558,153],[559,185],[560,118],[561,101],[562,175],[563,40],[564,35],[565,91],[566,167],[567,167],[568,121],[569,87],[570,179],[571,187],[572,133],[573,157],[574,76],[575,78],[576,73],[577,175],[578,183],[579,12],[580,161],[581,174],[582,117],[583,78],[584,112],[585,129],[586,98],[587,137],[588,59],[589,42],[590,79],[591,141],[592,177],[593,51],[594,99],[595,34],[596,161],[597,92],[598,103],[599,185],[600,165],[601,48],[602,69],[603,47],[604,94],[605,87],[606,15],[607,139],[608,196],[609,91],[610,173],[611,62],[612,156],[613,148],[614,98],[615,58],[616,97],[617,137],[618,136],[619,59],[620,41],[621,19],[622,141],[623,184],[624,148],[625,101],[626,145],[627,48],[628,148],[629,16],[630,112],[631,163],[632,113],[633,61],[634,46],[635,60],[636,106],[637,92],[638,194],[639,194],[640,11],[641,47],[642,198],[643,196],[644,36],[645,121],[646,64],[647,151],[648,97],[649,171],[650,146],[651,69],[652,32],[653,135],[654,65],[655,182],[656,26],[657,100],[658,135],[659,104],[660,114],[661,75],[662,106],[663,171],[664,27],[665,123],[666,84],[667,51],[668,187],[669,68],[670,66],[671,17],[672,199],[673,161],[674,60],[675,41],[676,62],[677,65],[678,28],[679,119],[680,61],[681,27],[682,81],[683,51],[684,190],[685,25],[686,43],[687,64],[688,181],[689,42],[690,194],[691,23],[692,152],[693,41],[694,187],[695,138],[696,25],[697,76],[698,153],[699,91],[700,105],[701,141],[702,164],[703,141],[704,56],[705,127],[706,88],[707,163],[708,56],[709,107],[710,138],[711,103],[712,192],[713,123],[714,129],[715,137],[716,85],[717,183],[718,41],[719,169],[720,124],[721,62],[722,139],[723,122],[724,130],[725,54],[726,74],[727,81],[728,168],[729,68],[730,48],[731,171],[732,75],[733,125],[734,185],[735,11],[736,100],[737,129],[738,46],[739,198],[740,108],[741,109],[742,52],[743,20],[744,73],[745,16],[746,65],[747,174],[748,57],[749,51],[750,24],[751,177],[752,29],[753,83],[754,71],[755,194],[756,161],[757,185],[758,91],[759,193],[760,170],[761,141],[762,73],[763,25],[764,199],[765,87],[766,63],[767,185],[768,178],[769,134],[770,124],[771,161],[772,60],[773,50],[774,35],[775,136],[776,46],[777,91],[778,108],[779,169],[780,89],[781,33],[782,150],[783,162],[784,22],[785,112],[786,45],[787,125],[788,102],[789,80],[790,134],[791,66],[792,71],[793,30],[794,170],[795,129],[796,43],[797,37],[798,110],[799,173],[800,193],[801,174],[802,73],[803,15],[804,121],[805,50],[806,58],[807,122],[808,167],[809,118],[810,100],[811,48],[812,120],[813,200],[814,55],[815,78],[816,57],[817,198],[818,57],[819,102],[820,68],[821,134],[822,98],[823,77],[824,62],[825,200],[826,55],[827,121],[828,122],[829,69],[830,96],[831,47],[832,44],[833,37],[834,37],[835,118],[836,178],[837,114],[838,123],[839,26],[840,16],[841,116],[842,60],[843,10],[844,30],[845,137],[846,172],[847,117],[848,119],[849,71],[850,170],[851,23],[852,24],[853,25],[854,184],[855,123],[856,59],[857,51],[858,37],[859,16],[860,48],[861,53],[862,35],[863,23],[864,124],[865,18],[866,72],[867,84],[868,148],[869,30],[870,39],[871,71],[872,60],[873,125],[874,57],[875,23],[876,190],[877,94],[878,190],[879,68],[880,35],[881,118],[882,127],[883,183],[884,108],[885,169],[886,50],[887,44],[888,94],[889,78],[890,180],[891,153],[892,170],[893,55],[894,137],[895,36],[896,144],[897,151],[898,120],[899,118]]"
            for c in arr:     
                time.sleep(0.5) 
                self.write_message(c)
        if message in cmd.keys():            
            for x in range(20):
                #  broadcast(x)
                self.write_message("pocket "+str(x) + " for client "+ self.id)
        
    
    def on_close(self):
        if self.id in clients:
            del clients[self.id]    
    
    @staticmethod        
    def broadcast(data):
        for ws in clients:
            # self.write_message("pocket "+str(x) + "for client "+ self.id)
            ws.write_message("pocket "+data+" for "+ws)
                
class Broadcast(tornado.websocket.WebSocketHandler):
    def get(self):
        try:
            with open(os.path.join(root, 'console.html')) as f:
                self.write(f.read())
        except IOError as e:
            self.write("404: Not Found" )

    def post(self):
        message = self.get_argument('message')
        key = self.get_argument('id', None)
        for client in ClientConnection.clients:
            if key and not key == client.id:
                continue
            client.send(message)
        self.write('message send.')


def render_template(filename):
    if os.path.isdir(os.path.join(template_root, filename)):
        filename = os.path.join(filename, 'console.html')
    else:
        filename = '%s.html' % filename
    if any(filename.lstrip('/').startswith(p) for p in blacklist_templates):
        print "error 1 with file"+ filename
    try:
        return template_lookup.get_template(filename).render()
    except exceptions.TopLevelLookupException:
        print "error 1 with file"+ filename
 
def main():    
    tornado.options.parse_command_line()
    app = Application()
    app.listen(options.port)
    #server = tornado.httpserver.HTTPServer(app)
    tornado.ioloop.IOLoop.instance().start()
    #tornado.ioloop.IOLoop.current().start()


    
if __name__ == "__main__":
    main()